# 検索結果を保存してExcelで利用する

ここでは，検索プログラム한마루2.0（以下「한마루」とする）で検索した結果を保存して，Excelに取り込むための方法について紹介します．

## 検索結果の保存

まずは目的のコーパスを開き，検索を行います．コーパスを開いただけの状態では，「파일」（ファイル）メニューの「저장」（「貯蔵」＝保存）以下のメニューがアクティブになっていません．

検索結果を表示してから，「파일」（ファイル）メニューの「저장」（「貯蔵」＝保存）を選択し，「검색 결과 저장」（検索結果の保存）を選択します．ここではファイル名を「다가」にしたとします．そうすると，以下のように二つのファイルが作成されます．

![excel_file](jakle/excel_file.png)

このうち，「다가」とだけ表示されているファイルは，環境によっては「다가.txt」と表示されるかもしれません．ともかく，いずれもUnicodeでエンコーディングされたテキストファイルです．「メモ帳」などのアプリケーションで開くことができます．以下では便宜上，「다가」（もしくは「다가.txt」）と表示されたファイルを「テキストファイル」，「.view」で終わっているファイルを「viewファイル」と呼ぶことにします．

## 二つのファイルの中身

どちらのファイルもテキスト形式のため，「メモ帳」や「EmEditor」などのテキストエディタで開くことができますが，viewファイルの方はアプリケーションとの関連付けが（ふつう）なされていないため，ダブルクリックで開くことは（ふつう）できません．ファイルを右クリックして「プログラムから開く」（Windowsの場合），「このアプリケーションで開く」（macOSの場合）などのメニューからアプリケーションを選択するか，テキストファイルを開くことができるアプリケーションからviewファイルを選択して，ファイルを開く必要があります．

### テキストファイル

テキストファイルを開くと，最初の数行は以下の通りになっています（10個の形態素解析済みコーパスから接続形語尾の「다가」を検索した例のうち，4行目まで抜粋）：

```
이전 문맥^검색어^이후 문맥
부부 사이는 점점 벌어져 다툼과 싸움을 ^계속하다가^ 이혼이라는 불행에 이를 수밖에 없다.^
그는 이렇게 모은 예금으로 사채놀이를 하는 등 82년부터 10년간 사금고를 ^운영하다가^ 발각돼 도주했다.^
레바논에서 5년 동안 인질로 억류돼 ^있다가^ 11일 풀려난 미국인 에드워드 트레이시는 맨 처음 "햄버거와 콜라가 먹고 싶다"고 말했다.^
```

1行に1データ（1例）が文単位で表示されており，前文脈と検索語，後文脈とが区切り文字「`^`」で区切られています．1行目は凡例となっています．

このファイルには文ごとの検索結果が最低限示されているだけで，出典ファイル名や出現位置は含まれていません．

### viewファイル

viewファイルは，한마루で保存された検索結果を開く場合に必要なファイルです．

上述の通り，viewファイルもテキスト形式のファイルです．平文コーパス（원시 말뭉치）の場合と形態素解析済みコーパス（형태분석 말뭉치）とで，保存される内容が異なります．

#### 平文コーパスのviewファイル

以下に示すのは，いくつかの平文コーパスから`*다가`を検索した結果を保存して，最初の数行を抜き出したものです．

```
161
0
^
NULL
이전 문맥^검색어^이후 문맥^추출 파일명^추출 파일 번호^시스템 코드(문장 식별자)^^내 컴퓨터 내 추출 파일 위치^시스템 코드(문장 식별자)^이전 문장^다음 문장
그런데 선거를 또 치르게 된다. 선거를 치르고 날 때마다 허탈과 회한의 늪 속에 빠져들어가지만, 그래서 다시는 그런 선거를 반복하지 않겠다고 다짐하지만, 또다시 망각 속에 선거를 맞곤 한다. 그래도 모처럼의 기회가  왔으니 실기할 수는 없다. 국회의원선거에 버금가는 광역의회선거가 아니라 기초의회선거이고 ^게다가^ 정당성까지 배제시킨다니 이번엔 선거개혁을 별러봐도 괜찮을 듯싶다.^2BA91A36.txt^0^326^^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\원시_말뭉치\2BA91A36.txt^326^선거열풍이 곧 몰아칠 듯하다. 1960년 12월의 도지사선거를 마지막으로 만 30년 만에 지방자치단체선거를 다시 치르게 된 셈이다. 정부수립 이후 지금까지 3번의 지자제선거를 포함해서 모두 36번의 각종 선거가 실시되었다. 횟수로만 보면 선거에 꽤나 익숙해진 백성일 듯싶은데 실제로는 그렇지가 못하다. 지난 선거과정에서 얻은 것은 헐뜯기였고 결과에서 느낀 것은 실망이었다. 깊은 사려 없이 누른 붓두껍은 의사정치인만 양산했다. 선거가 정치인의 충원과정으로 자리를 잡지 못한 이유가 거기 있었다. 민주제도는 투표함 속에서만 숨쉬어 이른바 `투표함 민주주의'가 피고 졌을 뿐이다. 선거 따로 있고 정치 따로 놀아 정국의 바퀴가 헛돌 수밖에 없었다.^그러기 위해서는 선거양상부터 제대로 돌아가야 한다. 당원단합이라는 명분으로 정당이 날뛰고, 선거법위반자를 솎아낸다고 관권이 잠행하고, 돈보따리가 풀리며 금권까지 춤을 추면 선거판은 애저녁에 끝장나 버리고 마니 `그 풍토'부터 고칠 각오를 단단히 해야 한다. 그러고 나서 무엇보다 앞세워야 할 것은 진정한 민의를 대변하는 의원을 뽑는 일이다.^^^
- 당초 판문점을 통해 서울로 ^오려다가^ 북경을 경유해 내한한 이유는.^2BA90A03.txt^1^3,587^^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\원시_말뭉치\2BA90A03.txt^1788^"유럽질서변화의 기초가 된 csce(유럽안보협력회의) 같은 논의가 동북아지역에서도 활성화돼야 할 것 같다. 특히 남북한 양측이 모두 관심을 갖고 있는 남북한 불가침조약등이 미-일-중-소 등 주변 4강의 보장하에 체결되면 긴장완화에 상당한 효과가 있을 것 같다. "^"사전에 남한과 유엔군 사령부측은 판문점경유에 동의했으나 북한측이 반대했다. 북한당국은 북한의 개방과 관련, 잘못된 오해를 불러일으킬 수 있다는 이유로 나의 판문점통과를 반대했다. "^^^
"아침8 시면 공장에 ^나갔다가^ 저녁 8 시에는 꼭 집으로 돌아오시는 분인데…. "^2BA90A35.txt^3^6,033^^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\원시_말뭉치\2BA90A35.txt^637^결혼 2년째인 주부 박상숙씨(22 서울 강동구 천호동)는 19일 남편이 경찰서에 붙잡혀 있다는 연락을 받고 새벽 같이 서울 신정경찰서로 달려갔다. 남편이 곧 풀려나겠느냐고 박씨가 묻자, 담당형사는 박씨의 남편 이재홍씨(30)등 일당 6 명으로부터 압수한 식칼과 가스총 등을 아무말 없이 보여 주었다.^박씨는 남편이 대낮에 가정집에 들어가 주부들을 인질로 삼고 60여 차례나 강도 짓을 했다는 경찰의 설명을 믿을 수가 없었다.^^^
```

最初の4行はプログラムで用いるデータと思われます．5行目には各項目の見出し，6行目以降がそれぞれのデータとなっています．見出しと，それに対応するデータを5行目，6行目を例に列挙します：

  - 이전 문맥：그런데 선거를 또 치르게 된다. 선거를 치르고 날 때마다 허탈과 회한의 늪 속에 빠져들어가지만, 그래서 다시는 그런 선거를 반복하지 않겠다고 다짐하지만, 또다시 망각 속에 선거를 맞곤 한다. 그래도 모처럼의 기회가  왔으니 실기할 수는 없다. 국회의원선거에 버금가는 광역의회선거가 아니라 기초의회선거이고 
  - 검색어：게다가
  - 이후 문맥： 정당성까지 배제시킨다니 이번엔 선거개혁을 별러봐도 괜찮을 듯싶다.
  - 추출 파일명：2BA91A36.txt
  - 추출 파일 번호：0
  - 시스템 코드(문장 식별자)：326
  - （空白の項目）：
  - 내 컴퓨터 내 추출 파일 위치：`D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\원시_말뭉치\2BA91A36.txt`
  - 시스템 코드(문장 식별자)：326
  - 이전 문장：선거열풍이 곧 몰아칠 듯하다. 1960년 12월의 도지사선거를 마지막으로 만 30년 만에 지방자치단체선거를 다시 치르게 된 셈이다. 정부수립 이후 지금까지 3번의 지자제선거를 포함해서 모두 36번의 각종 선거가 실시되었다. 횟수로만 보면 선거에 꽤나 익숙해진 백성일 듯싶은데 실제로는 그렇지가 못하다. 지난 선거과정에서 얻은 것은 헐뜯기였고 결과에서 느낀 것은 실망이었다. 깊은 사려 없이 누른 붓두껍은 의사정치인만 양산했다. 선거가 정치인의 충원과정으로 자리를 잡지 못한 이유가 거기 있었다. 민주제도는 투표함 속에서만 숨쉬어 이른바 `투표함 민주주의'가 피고 졌을 뿐이다. 선거 따로 있고 정치 따로 놀아 정국의 바퀴가 헛돌 수밖에 없었다.
  - 다음 문장：그러기 위해서는 선거양상부터 제대로 돌아가야 한다. 당원단합이라는 명분으로 정당이 날뛰고, 선거법위반자를 솎아낸다고 관권이 잠행하고, 돈보따리가 풀리며 금권까지 춤을 추면 선거판은 애저녁에 끝장나 버리고 마니 `그 풍토'부터 고칠 각오를 단단히 해야 한다. 그러고 나서 무엇보다 앞세워야 할 것은 진정한 민의를 대변하는 의원을 뽑는 일이다.

#### 形態素解析済みコーパスのviewファイル

いくつかの形態素解析済みコーパスから，接続形語尾の「다가」を検索した例の保存データを数行提示すれば，以下の通りです：

```
81
1
^
NULL
이전 문맥^검색어^이후 문맥^추출 파일명^추출 파일 번호^시스템 코드(문장 식별자)^시스템 코드^내 컴퓨터 내 추출 파일 위치^시스템 코드(문장 식별자)^이전 문장^다음 문장^시스템 코드^시스템 코드^시스템 코드
부부 사이는 점점 벌어져 다툼과 싸움을 ^계속하다가^ 이혼이라는 불행에 이를 수밖에 없다.^BTAA0010.txt^0^583^ 계속/NNG하/XSV다가/EC^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\형태분석_말뭉치\BTAA0010.txt^583^상대를 의심하면 의심이 의심을 낳아 오해가 생긴다.^서로 신뢰하면 경제적으로 아무리 어렵더라도 고생을 고생으로 여기지 않고 행복한 미래의 꿈을 설계할 수 있다.^ 부부/NNG 사이/NNG는/JX 점점/MAG 벌어지/VV어/EC 다툼/NNG과/JC 싸움/NNG을/JKO 계속/NNG하/XSV다가/EC 이혼/NNG이/VCP라는/ETM 불행/NNG에/JKB 이르/VVᆯ/ETM 수/NNB밖에/JX 없/VA다/EF./SF^부부/NNG	사이/NNG + 는/JX	점점/MAG	벌어지/VV + 어/EC	다툼/NNG + 과/JC	싸움/NNG + 을/JKO	계속/NNG + 하/XSV + 다가/EC	이혼/NNG + 이/VCP + 라는/ETM	불행/NNG + 에/JKB	이르/VV + ᆯ/ETM	수/NNB + 밖에/JX	없/VA + 다/EF + ./SF^
그는 이렇게 모은 예금으로 사채놀이를 하는 등 82년부터 10년간 사금고를 ^운영하다가^ 발각돼 도주했다.^BTAA0007.txt^7^12,615^ 운영/NNG하/XSV다가/EC^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\형태분석_말뭉치\BTAA0007.txt^631^송씨는 신협 중앙회에서 발행하는 정기 예탁 증서와 같은 양식의 수기 통장을 만들어 최고 연 20%까지 이자를 준다며 인근 주민과 사채업자들로부터 1백 1억원의 예금을 끌어 모았다.^은감원은 "횡령 사고의 경우 금융기관 직원이 잠시 주식 투자 등에 사용한 뒤 다시 채워넣을 생각으로 예금을 횡령했다가 더 큰 손실을 입고 발각되는 경우가 많다"고 전했다.^ 그/NP는/JX 이렇/VA게/EC 모으/VVᆫ/ETM 예금/NNG으로/JKB 사채놀이/NNG를/JKO 하/VV는/ETM 등/NNB 82/SN년/NNB부터/JX 10/SN년/NNB간/NNG 사/NNG금고/NNG를/JKO 운영/NNG하/XSV다가/EC 발각/NNG되/XSV어/EC 도주/NNG하/XSV았/EP다/EF./SF^그/NP + 는/JX	이렇/VA + 게/EC	모으/VV + ᆫ/ETM	예금/NNG + 으로/JKB	사채놀이/NNG + 를/JKO	하/VV + 는/ETM	등/NNB	82/SN + 년/NNB + 부터/JX	10/SN + 년/NNB + 간/NNG	사/NNG + 금고/NNG + 를/JKO	운영/NNG + 하/XSV + 다가/EC	발각/NNG + 되/XSV + 어/EC	도주/NNG + 하/XSV + 았/EP + 다/EF + ./SF^
레바논에서 5년 동안 인질로 억류돼 ^있다가^ 11일 풀려난 미국인 에드워드 트레이시는 맨 처음 "햄버거와 콜라가 먹고 싶다"고 말했다.^BTAA0005.txt^5^9,276^ 있/VX다가/EC^D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\형태분석_말뭉치\BTAA0005.txt^1942^'에드워드 트레이시'(기자수첩)^그는 무엇이 제일 기쁜가라는 질문에 "나무와 버스를 다시 볼 수 있다니…"라며 말끝을 흐렸다.^ 레바논/NNP에서/JKB 5/SN년/NNB 동안/NNG 인질/NNG로/JKB 억류/NNG되/XSV어/EC 있/VX다가/EC 11/SN일/NNB 풀려나/VVᆫ/ETM 미국인/NNG 에드워드/NNP 트레이시/NNP는/JX 맨/MM 처음/NNG "/SS햄버거/NNG와/JC 콜라/NNG가/JKS 먹/VV고/EC 싶/VX다/EC"/SS고/JKQ 말/NNG하/XSV았/EP다/EF./SF^레바논/NNP + 에서/JKB	5/SN + 년/NNB	동안/NNG	인질/NNG + 로/JKB	억류/NNG + 되/XSV + 어/EC	있/VX + 다가/EC	11/SN + 일/NNB	풀려나/VV + ᆫ/ETM	미국인/NNG	에드워드/NNP	트레이시/NNP + 는/JX	맨/MM	처음/NNG	"/SS + 햄버거/NNG + 와/JC	콜라/NNG + 가/JKS	먹/VV + 고/EC	싶/VX + 다/EC + "/SS + 고/JKQ	말/NNG + 하/XSV + 았/EP + 다/EF + ./SF^
```

こちらも各項目を列挙し，合わせて6行目の内容も項目ごとに提示します：

  - 이전 문맥：부부 사이는 점점 벌어져 다툼과 싸움을 
  - 검색어：계속하다가
  - 이후 문맥：이혼이라는 불행에 이를 수밖에 없다.
  - 추출 파일명：BTAA0010.txt
  - 추출 파일 번호：0
  - 시스템 코드(문장 식별자)：583
  - 시스템 코드：계속/NNG하/XSV다가/EC
  - 내 컴퓨터 내 추출 파일 위치：`D:\SejongCorpus_2011\현대\문어\현대문어_말뭉치\형태분석_말뭉치\BTAA0010.txt`
  - 시스템 코드(문장 식별자)：583
  - 이전 문장：상대를 의심하면 의심이 의심을 낳아 오해가 생긴다.
  - 다음 문장：서로 신뢰하면 경제적으로 아무리 어렵더라도 고생을 고생으로 여기지 않고 행복한 미래의 꿈을 설계할 수 있다.
  - 시스템 코드：부부/NNG 사이/NNG는/JX 점점/MAG 벌어지/VV어/EC 다툼/NNG과/JC 싸움/NNG을/JKO 계속/NNG하/XSV다가/EC 이혼/NNG이/VCP라는/ETM 불행/NNG에/JKB 이르/VVᆯ/ETM 수/NNB밖에/JX 없/VA다/EF./SF
  - 시스템 코드：부부/NNG	사이/NNG + 는/JX	점점/MAG	벌어지/VV + 어/EC	다툼/NNG + 과/JC	싸움/NNG + 을/JKO	계속/NNG + 하/XSV + 다가/EC	이혼/NNG + 이/VCP + 라는/ETM	불행/NNG + 에/JKB	이르/VV + ᆯ/ETM	수/NNB + 밖에/JX	없/VA + 다/EF + ./SF
  - 시스템 코드

上記の結果から分かるように，平文コーパスの保存内容に加えて，品詞タグがついた項目が含まれています．

## Excelへの取り込み

上記のファイルをExcelから呼び出します．Excelを起動し，「ファイル」メニューから「開く…」を選択します．「開く」ダイアログで「ファイルの種類」を「テキストファイル」とすると，テキストファイルが表示され開くことができます．「ファイルの種類」を「すべてのファイル」とすれば，viewファイルも選択可能になります．[^file_dialog]	

「テキストファイルウィザード」（あるいはそれに類するもの）では，以下のダイアログのように設定します．

![テキストファイルウィザード1](jakle/corpus_excel_text_wizard_1.png?400)
![テキストファイルウィザード2](jakle/corpus_excel_text_wizard_2.png?400)

ポイントは文字コードを「Unicode(UTF-8)」にすること（「Unicode」や「UTF-16LE」があればそちらを選択），区切り文字を「`^`」とすることです．テキストファイルでもviewファイルでも設定は同じです．

viewファイルを読み込んだ場合の結果は以下の通り：

![テキスト読込結果](jakle/corpus_excel_text_done.png?600)

不要な列は削除して，Excel形式で保存しましょう．データの整理に用いることができます．

\<WRAP center round warning 100%\>
viewファイルは한마루で検索結果を読み込む場合に必要なファイルです．Excel形式や別の名前で保存する前に改変し，上書き保存してしまうと，한마루で開いた場合に予期しない結果が表示されるかもしれません．
\</WRAP\>

{{indexmenu_n>44}}

[^file_dialog]: Excel for Macなどのバージョンによっては，「ファイルの種類」で「すべてのファイル」などといった指定ができないかもしれません．その場合には上記[二つのファイルの中身](#二つのファイルの中身)で説明したように，viewファイルを右クリックしてExcelを選択するか，viewファイルの拡張子「`.view`」部分を「`.txt`」に変更してExcelから開いてみましょう．